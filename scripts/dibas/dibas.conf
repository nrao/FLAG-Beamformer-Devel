[DEFAULTS]
# Subsystems in use.  This is a set of subsystems, with A=1, B=2, etc,
# up to 8.  If it appears in this list, it is available.  The list may
# consist of comma-separated values (1, 2, 3, etc.), or ranges (1-8,
# 3-6, etc.), or a combination of both (1, 2, 5-8).  Too many values,
# duplicate values, or values greater than 8 or less than 1 will
# result in the coordinator calling exit(1), with the appropriate
# message in the manager's log file.
#subsystems = 1,2
subsystems = 1-4
#subsystems = 1,7,8

# Simulate hardware by default?
simulate = 0
# log katcp commands? 0 = No, n > 0 = log last n commands
log_katcp = 10
# Which bank is switching master?
who_is_master = A

# paths for the vegas_hpc_servers
# vegas-hpc & others found in /home/dibas tree.
python_path = /home/gbt7/newt
cuda_path = /opt/local/cuda42/lib64
lib_path = /home/gbt7/newt/lib:/opt/local/cuda42/lib64
fifo_name = /tmp/vegas_daq_control
vegas-hpc = vegas_hpc_server

# Bank configurations.
#
# datahost        : The 10Gbs IP address for the roach
# dataport        : The 10Gbs port for the roach
# dest_ip         : The 10Gbs HPC IP address
# dest_port       : The 10Gbs HPC port
# katcp_ip        : The KATCP host, on the 1Gbs network
# katcp_port      : The KATCP port on the 1Gbs network
# synth           : 'local' if Valon is attached to HPC, 'katcp' if onboard the roach PPC
# synth_port      : The Valon synthesizer serial port
# synth_ref       : Valon frequency reference, 'internal' or 'external'
# synth_ref_freq  : Valon reference frequency
# synth_vco_range : Valon VCO range
# synth_rf_level  : The RF output level, in dBm. Legal values are -4, -1, 2, and 5
# synth_options   : Valon options. With the exception of the reference frequency multiplier,
#                   all of these are flags which either are clear (0) or set (1)
#                   doubler, halver, multiplier, low-spur
#
# Optional:
#
#    shmkeys      : A key of keys. The comma-separated list will be interpreted as keys to
#                   kv pairs in this section, which themselves will be read and placed in
#                   the status shared memory. In the following example, 'FOO':'cat',
#                   'BAR':'frog' and 'BAZ':'dog' will be placed in shared memory. If 'shmkeys'
#                   is missing, or has an empty list, or if any of the keys listed by 'shmkeys'
#                   is missing, no kv pairs will be loaded into shared status memory:
#
#                   shmkeys = foo,bar,baz
#                   foo = cat
#                   bar = frog
#                   baz = dog
[BANKA]
datahost = 10.17.0.64
dataport = 60000
dest_ip = 0x0A110020
dest_port = 60000
katcp_ip = vegasr2-1
katcp_port = 7147
synth = local
synth_port = /dev/ttyS0
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[BANKB]
datahost = 10.17.0.65
dataport = 60000
dest_ip = 0x0A110021
dest_port = 60000
katcp_ip = vegasr2-2
katcp_port = 7147
synth = local
synth_port = /dev/ttyS0
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[BANKC]
datahost = 10.17.0.66
dataport = 60000
dest_ip = 0x0A110022
dest_port = 60000
katcp_ip = vegasr2-3
katcp_port = 7147
synth = local
synth_port = /dev/ttyS0
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[BANKD]
datahost = 10.17.0.67
dataport = 60000
dest_ip = 0x0A110023
dest_port = 60000
katcp_ip = vegasr2-4
katcp_port = 7147
synth = local
synth_port = /dev/ttyS0
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[BANKE]
datahost = 10.17.0.68
dataport = 60000
dest_ip = 0x0A11002A
dest_port = 60000
katcp_ip = vegasr2-5
katcp_port = 7147
synth = local
synth_port = /dev/ttyS0
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[BANKF]
datahost = 10.17.0.69
dataport = 60000
dest_ip = 0x0A110028
dest_port = 60000
katcp_ip = vegasr2-6
katcp_port = 7147
synth = local
synth_port =  /dev/ttyUSB0
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[BANKG]
datahost = 10.17.0.70
dataport = 60000
dest_ip = 0x0A11002C
dest_port = 60000
katcp_ip = vegasr2-7
katcp_port = 7147
synth = local
synth_port = /dev/ttyS0
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[BANKH]
datahost = 10.17.0.71
dataport = 60000
dest_ip = 0x0A110022
# dest_ip = 0x0A11002E
dest_port = 60000
katcp_ip = vegasr2-8
katcp_port = 7147
synth = katcp
synth_port = /dev/ttyS1
synth_ref = external
synth_ref_freq = 10000000
synth_vco_range = 2200, 4400
synth_rf_level = 5
synth_options = 0,0,1,0

[MODE1]
shmkeys = obs_mode
obs_mode = hbw

needed_arm_delay = 5
acc_len = 768
#bof_file = v01_na_ri_8r4t11f_ver108_2012_Mar_21_0636.bof
#bof_file = v01_na_ri_8r4t11f_ver109_2012_Apr_26_2112.bof
#bof_file = v01_na_ri_8r4t11f_ver111_2012_Jul_13_1430.bof
#bof_file = v01_aa_rii_16r4t11f_ver117sa_2012_Dec_11_0038.bof
#bof_file = v01_aa_rii_16r4t11f_ver122sa_2012_Dec_14_1554.bof
#bof_file = v01_md_16r4t11f_ver125sa_2012_Dec_19_0330.bof
#bof_file = v01_16r4t11f_ver126_2012_Dec_19_0248.bof
#bof_file = v01_16r4t11f_ver131_2013_Jan_10_1815.bof
#bof_file = v01_16r4t11f_ver132_2013_Jan_23_1559.bof
#bof_file = v01_16r4t11f_ver135_2013_Jan_31_1406.bof
#bof_file = v01_16r4t11f_ver141_2013_Feb_19_1801.bof
#bof_file = v01_16r4t11f_ver149bb_2013_Mar_18_1337.bof
bof_file = v01_16r4t11f_ver151bb_2013_Apr_08_1501.bof
filter_bw = 1400
frequency = 1440e6
#sg_period = 44040188 # acc_len * 32 * 256 * 7 - 4
# changed as part of the start issue
#sg_period = 704643068 # acc_len * 32 * 16 * 7 * 256 - 4

# sg_period = acc_len * 32 * 16 * 7 * 256 - 2 latest (v135) bof file
sg_period = 704643070

# This array sets up the master_slave_sel values based on whether the
# manager is master, what the switching signal source is
# (internal/external), and what the blanking source is
# (internal/external).  The order of the elements is as follows:
#   m/int/int, m/int/ext, m/ext/ext,
#   s/int/int, s/int/ext, s/ext/ext
master_slave_sel = 0x00,0x00,0x00,0x0E,0x00,0x00

# These are the sequence of KATCP commands (and delays) needed to reset,
# arm, and disarm the roach. They are interpreted and executed by the
# manager.  The sequences consist of pairs of values: command,parameter;
# i.e. sg_sync is the command, 0x12 is the parameter.  All commands
# are on even indexes, all parameters on odd indexes.
reset_phase = sg_sync,0x12,wait,0.1,arm,0,arm,1,wait,0.1,arm,0,arm,1,arm,0,wait,0.5,sg_sync,0x11,wait,0.1
arm_phase = sg_sync,0x12,arm,0,arm,1,arm,0,wait,0.2,arm,1,arm,0,wait,0.05,sg_sync,0x14
postarm_phase = sg_sync,0x10

file_system = /lustre/gbtdata

[MODE13]
shmkeys = obs_mode
obs_mode = lbw

needed_arm_delay = 5
acc_len = 256
bof_file =
filter_bw = 950
frequency = 150e6

# sg_period = acc_len * 32 * 256 - 4
sg_period = 2088956
# vegas-hpc = vegas_hpc_lbw
# This array sets up the master_slave_sel values based on whether the
# manager is master, what the switching signal source is
# (internal/external), and what the blanking source is
# (internal/external).  The order of the elements is as follows:
#   m/int/int, m/int/ext, m/ext/ext,
#   s/int/int, s/int/ext, s/ext/ext
master_slave_sel = 0x40,0x00,0x00,0x02,0x00,0x00

# These are the sequence of KATCP commands needed to reset, arm, and
# disarm the roach. They are interpreted and executed by the manager.
reset_phase = sg_sync,0x12,wait,0.1,arm,0,arm,1,wait,0.1,arm,0,arm,1,arm,0,wait,0.5,sg_sync,0x11
arm_phase = sg_sync,0x12,arm,0,arm,1,arm,0,wait,0.1,arm,1,arm,0,wait,0.05,sg_sync,0x14
postarm_phase = sg_sync,0x10

file_system = /home/gbtdata

[COHERENT_DEDISPERSION_MODE]
shmkeys = obs_mode
obs_mode = lbw

# ROACH and HPC host to be used. The values refer to the sections
# above. Hence, 'cdd_roach=BANKA' means that the roach used would be the
# one indicated by 'katcp_ip' of that section. The various 10Gb/s
# interfaces on the roach would be those used by all the BANKX sections
# above.
#
# Only one HPC player is responsible for setting up and controlling the
# ROACH. The others merely set up their shared memory areas for the HPC
# program, and start and stop the HPC program. The various keywords are:
#
#  cdd_roach: Refers to the BANK section above that identifies the
#  desired ROACH, and any configurations for that roach (for example,
#  the Valon).
#
#  cdd_roach_ips: The above ROACH must be programmed with 10Gb/s IP
#  addresses. These are to be found in the sections listed by this key,
#  in the order given.
#
#  cdd_hpcs: Indicates the HPC hosts that the data should be sent
#  to. Again, it does this by specifying the 'BANK' sections above, in
#  the order given.  For example, BANKE's 'dest_ip' would specify the
#  destination IP to be used.
#
#  cdd_master_hpc: The HPC host whose Player is to control the
#  ROACH. This Player must program the ROACH, issue the arm command,
#  etc, in addition to doing the other things all the Players must do to
#  make this measurement work (shared memory, start the HPC server
#  processes, etc.)

cdd_roach = BANKH
cdd_roach_ips = 10.17.0.71,10.17.0.79,10.17.0.80,10.17.0.81,10.17.0.82,10.17.0.83,10.17.0.84,10.17.0.85
cdd_hpcs = BANKA,BANKB,BANKC,BANKD,BANKE,BANKF,BANKG,BANKH
cdd_master_hpc = BANKH

needed_arm_delay = 5
acc_len = 256
bof_file = dibas_codd_0064_t12_w095_x05_2013_May_16_1715.bof
filter_bw = 950
frequency = 100e6

# sg_period = acc_len * 32 * 256 - 4
sg_period = 2088956
# vegas-hpc = vegas_hpc_lbw
# This array sets up the master_slave_sel values based on whether the
# manager is master, what the switching signal source is
# (internal/external), and what the blanking source is
# (internal/external).  The order of the elements is as follows:
#   m/int/int, m/int/ext, m/ext/ext,
#   s/int/int, s/int/ext, s/ext/ext
master_slave_sel = 0x40,0x00,0x00,0x02,0x00,0x00

# These are the sequence of KATCP commands needed to reset, arm, and
# disarm the roach. They are interpreted and executed by the manager.
reset_phase = sg_sync,0x12,wait,0.1,arm,0,arm,1,wait,0.1,arm,0,arm,1,arm,0,wait,0.5,sg_sync,0x11
arm_phase = sg_sync,0x12,arm,0,arm,1,arm,0,wait,0.1,arm,1,arm,0,wait,0.05,sg_sync,0x14
postarm_phase = sg_sync,0x10

file_system = /home/gbtdata
